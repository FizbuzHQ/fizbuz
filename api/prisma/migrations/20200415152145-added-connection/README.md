# Migration `20200415152145-added-connection`

This migration has been generated by Carter Rabasa at 4/15/2020, 3:21:45 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "quaint"."Connection" (
    "comment" TEXT   ,
    "connectedId" TEXT NOT NULL  ,
    "createdAt" DATE NOT NULL DEFAULT CURRENT_TIMESTAMP ,
    "deletedAt" DATE   ,
    "id" TEXT NOT NULL  ,
    "pin" TEXT NOT NULL  ,
    "updatedAt" DATE   ,
    "userId" TEXT NOT NULL  ,
    PRIMARY KEY ("id"),FOREIGN KEY ("userId") REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE,
FOREIGN KEY ("connectedId") REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE
) 

CREATE UNIQUE INDEX "quaint"."Connection.userId_connectedId" ON "Connection"("userId","connectedId")
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200415145116-init..20200415152145-added-connection
--- datamodel.dml
+++ datamodel.dml
@@ -1,20 +1,37 @@
 datasource DS {
   provider = "sqlite"
-  url = "***"
+  url      = env("DATABASE_URL")
 }
 generator client {
   provider      = "prisma-client-js"
   binaryTargets = env("BINARY_TARGET")
 }
 model User {
-  id               String    @default(cuid()) @id
-  auth0Sub         String
-  email            String    @unique
-  productEmail     Boolean   @default(true)
-  promotionalEmail Boolean   @default(true)
-  createdAt        DateTime  @default(now())
-  updatedAt        DateTime?
-  deletedAt        DateTime?
+  id                  String       @default(cuid()) @id
+  auth0Sub            String
+  email               String       @unique
+  productEmail        Boolean      @default(true)
+  promotionalEmail    Boolean      @default(true)
+  inboundConnections  Connection[] @relation("inboundConnections")
+  outboundConnections Connection[] @relation("outboundConnections")
+  createdAt           DateTime     @default(now())
+  updatedAt           DateTime?
+  deletedAt           DateTime?
 }
+
+model Connection {
+  id          String    @default(cuid()) @id
+  user        User      @relation("outboundConnections", fields: [userId], references: [id])
+  userId      String
+  connected   User      @relation("inboundConnections", fields: [connectedId], references: [id])
+  connectedId String
+  pin         String
+  comment     String?
+  createdAt   DateTime  @default(now())
+  updatedAt   DateTime?
+  deletedAt   DateTime?
+
+  @@unique([userId, connectedId])
+}
```


